<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Agendar Turno</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
<div th:replace="~{layouts/navbar :: navbar('RECEPTIONIST')}"></div>
<div class="container mt-4">
    <div class="card shadow">
        <div th:replace="~{fragments/card-header :: cardHeader('bi-calendar-plus', 'Agendar Turno')}"></div>
        <div class="card-body">
            <form method="post" th:action="@{/appointments/schedule}" th:object="${appointment}">
                <input th:field="*{id}" type="hidden"/>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Cliente</label>
                        <select class="form-select" id="clientId" name="clientId" required th:field="*{customer.id}">
                            <option disabled value="">Seleccione un cliente</option>
                            <option th:each="client : ${clients}"
                                    th:value="${client.id}"
                                    th:text="${client.firstName + ' ' + client.lastName}"
                                    th:selected="${client.id == appointment.customer?.id}"></option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Mascota</label>
                        <select class="form-select" id="petId" name="petId" required th:field="*{pet.id}">
                            <option disabled value="">Seleccione una mascota</option>
                            <option th:each="pet : ${pets}"
                                    th:selected="${pet.id == appointment.pet?.id}"
                                    th:text="${pet.name}"
                                    th:value="${pet.id}"></option>
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Fecha</label>
                        <input class="form-control" required th:field="*{date}" type="date">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Hora</label>
                        <input class="form-control" required th:field="*{time}" type="time">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label class="form-label">Servicio</label>
                        <select class="form-select" id="serviceId" name="serviceId" required>
                            <option disabled selected value="">Seleccione un servicio</option>
                            <option th:each="service : ${services}" th:text="${service.name}"
                                    th:value="${service.id}"></option>
                        </select>
                    </div>
                </div>
                <div class="d-flex justify-content-center mt-4">
                    <button class="btn btn-success mx-2" type="submit">
                        <i class="bi bi-calendar-plus"></i> Registrar Turno
                    </button>
                    <a class="btn btn-secondary mx-2" th:href="@{/receptionist/dashboard}">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('clientId').addEventListener('change', function () {
        const selectedValue = this.value;
        const url = new URL(window.location.href);
        if (selectedValue) {
            url.searchParams.set('clientId', selectedValue);
        } else {
            url.searchParams.delete('clientId');
        }
        window.location.href = url.toString();
    });
</script>
</body>
</html>
