<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Detalle Historia Clínica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">
<div th:replace="~{cliente/barra_navegacion :: barra_navegacion}"></div>

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0">Historia Clínica de <span th:text="${historia.paciente.nombre}"></span></h3>
        </div>

        <div class="card-body">
            <div class="mb-4">
                <h4 class="mb-3 border-bottom pb-2">Información Básica</h4>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label"><strong>Autor original:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.veterinario.nombre + ' ' + historia.veterinario.apellido}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Última actualización por:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.ultimoVeterinario.nombre + ' ' + historia.ultimoVeterinario.apellido}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Fecha:</strong></label>
                        <div>
                            <span class="d-block" th:text="${#temporals.format(historia.fecha, 'dd/MM/yyyy')}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Propietario:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.propietario.nombre + ' ' + historia.propietario.apellido}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Motivo Consulta:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.motivoConsulta}"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4 border p-3 rounded" th:if="${historia.examenClinico}">
                <h4 class="mb-3 border-bottom pb-2">Examen Clínico</h4>
                <div class="row g-3">
                    <div class="col-md-3">
                        <label class="form-label"><strong>Temperatura (°C):</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.temperatura}"></span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label"><strong>Frec. Cardíaca (lpm):</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.frecuenciaCardiaca}"></span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label"><strong>Frec. Respiratoria (rpm):</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.frecuenciaRespiratoria}"></span>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label"><strong>Pulso (lpm):</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.pulso}"></span>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label"><strong>Mucosas:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.mucosas}"></span>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label"><strong>Temperamento:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.temperamento?.name()}"></span>
                        </div>
                    </div>

                    <div class="col-12">
                        <label class="form-label"><strong>Descripción:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.examenClinico.descripcion}"></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4" th:if="${historia.anamnesis}">
                <h4 class="mb-3 border-bottom pb-2">Anamnesis</h4>
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label"><strong>Última Desparasitación:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.anamnesis?.ultimaDesparasitacion} ?
                                  ${#temporals.format(historia.anamnesis.ultimaDesparasitacion, 'dd/MM/yyyy')} : 'N/A'"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Estado Reproductivo:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.anamnesis.estadoReproductivo?.name()}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Alimentación:</strong></label>
                        <div>
                            <span class="d-block" th:text="${historia.anamnesis.alimentacion}"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Último Celo:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.anamnesis?.ultimoCelo} ?
                                  ${#temporals.format(historia.anamnesis.ultimoCelo, 'dd/MM/yyyy')} : 'N/A'"></span>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <label class="form-label"><strong>Último Parto:</strong></label>
                        <div>
                            <span class="d-block"
                                  th:text="${historia.anamnesis?.ultimoParto} ?
                                  ${#temporals.format(historia.anamnesis.ultimoParto, 'dd/MM/yyyy')} : 'N/A'"></span>
                        </div>
                    </div>

                    <div class="col-12" th:if="${not historia.anamnesis.vacunas.empty}">
                        <div class="card shadow-sm">
                            <div class="card-header">
                                <h5 class="mb-0">Vacunas aplicadas</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-light">
                                        <tr>
                                            <th>Fecha</th>
                                            <th>Marca</th>
                                            <th>Lote</th>
                                            <th>Dosis</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="vacuna : ${historia.anamnesis.vacunas}">
                                            <td th:text="${#temporals.format(vacuna.fechaAplicacion, 'dd/MM/yyyy')}"></td>
                                            <td th:text="${vacuna.marca}"></td>
                                            <td th:text="${vacuna.lote}"></td>
                                            <td th:text="${vacuna.dosis}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4" th:if="${not historia.diagnosticos.empty}">
                <h4 class="mb-3 border-bottom pb-2">Diagnósticos</h4>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="list-group">
                            <div class="list-group-item mb-2 shadow-sm"
                                 th:each="diagnostico : ${historia.diagnosticos}">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="fw-bold">Diagnóstico #<span th:text="${diagnosticoStat.count}"></span>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <span class="d-block"
                                          th:text="${#strings.listJoin(diagnostico.problemas, ', ')}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-4" th:if="${not historia.tratamientos.empty}">
                <h4 class="mb-3 border-bottom pb-2">Tratamientos</h4>
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                <tr>
                                    <th>Producto</th>
                                    <th>Vía</th>
                                    <th>Frecuencia</th>
                                    <th>Periodo</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="tratamiento : ${historia.tratamientos}">
                                    <td th:text="${tratamiento.producto}"></td>
                                    <td th:text="${tratamiento.via}"></td>
                                    <td th:text="${tratamiento.frecuencia}"></td>
                                    <td>
                                        <span th:text="${#temporals.format(tratamiento.fechaInicio, 'dd/MM/yyyy')}"></span>
                                        -
                                        <span th:text="${#temporals.format(tratamiento.fechaFin, 'dd/MM/yyyy')}"></span>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4">
                <div class="row g-3 align-items-center">
                    <div class="col-md-12">
                        <a class="btn btn-secondary w-100" th:href="@{/cliente/interfaz_cliente}">
                            <i class="bi bi-arrow-left me-2"></i> Volver
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/webjars/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>
</body>
</html>